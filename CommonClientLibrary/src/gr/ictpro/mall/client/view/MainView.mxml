<?xml version="1.0" encoding="utf-8"?>
<s:Group xmlns:fx="http://ns.adobe.com/mxml/2009"
		 xmlns:s="gr.ictpro.mall.client.components.*"
		  xmlns:signals="org.osflash.signals.*"
		  width="100%" height="100%" currentState="default" xmlns:mx="library://ns.adobe.com/flex/mx">
	<s:states>
		<mx:State name="default"/>
		<mx:State name="menu"/>
	</s:states>
	<s:transitions>
		<s:Transition fromState="*" toState="*">
			<s:Move target="{mainMenu}" duration="100" />
		</s:Transition>
	</s:transitions>
	<fx:Declarations>
		<signals:Signal id="menuClicked"/>
	</fx:Declarations>
	<fx:Script>
		<![CDATA[
			import flash.desktop.NativeApplication;
			
			import gr.ictpro.mall.client.model.Device;
			import gr.ictpro.mall.client.model.User;
			import gr.ictpro.mall.client.model.menu.MenuItemCommand;
			
			import mx.core.IVisualElementContainer;
			
			[Bindable]
			public var user:User;
			
			public function dispose():void
			{
				if(parent && parent.contains(this))
					IVisualElementContainer(parent).removeElement(this);
			}

			protected function showMenu(event:MouseEvent):void
			{
				if(currentState == "default") {
					currentState = "menu";
				} else {
					currentState = "default";
				}
				
			}
			
			protected function mainMenu_changeHandler(event:Event):void
			{
				currentState="default";
				menuClicked.dispatch(mainMenu.selectedItem);

			}
			
		]]>
	</fx:Script>
	<s:Group id="topBar" top="0" width="100%" height="40">
		<s:Rect width="100%" height="100%">
			<s:fill><s:SolidColor color="0xAAAAAA" /></s:fill>
		</s:Rect>
		<s:Group top="0" height="40" click="showMenu(event)">
			<s:layout>
				<s:HorizontalLayout paddingLeft="5" paddingRight="5" verticalAlign="middle" gap="10"/>
			</s:layout>
			<s:Image source="{user.photo}" width="21" height="28" />
			<s:Label color="0xFFFFFF" fontWeight="normal" text="{user.name}"
					 fontSize="20"/>
		</s:Group>
	</s:Group>
	<s:Menu id="mainMenu" width="200" bottom="0" top="{topBar.height}" x.default="{-mainMenu.width}" x.menu="0" menuList="{user.getMenu()}" change="mainMenu_changeHandler(event)"/>
	
</s:Group>
