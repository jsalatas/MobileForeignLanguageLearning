<?xml version="1.0" encoding="utf-8"?>
<components:TopBarGroup xmlns:fx="http://ns.adobe.com/mxml/2009"
						xmlns:s="library://ns.adobe.com/flex/spark"
						xmlns:components="gr.ictpro.mall.client.components.*"
						xmlns:signals="org.osflash.signals.*"
						width="100%" height="100%" cancelButton="false"
						okClicked="topbargroup1_okClickedHandler(event)"
						backClicked="topbargroup1_backClickedHandler(event)">
	<fx:Declarations>
		<signals:Signal id="ok"/>
	</fx:Declarations>
	
	<fx:Script>
		<![CDATA[
			import mx.core.IVisualElementContainer;
			[Bindable]
			public var image:BitmapData;
			
			const WIDTH:int = 150;
			const HEIGHT:int = 200;
			
			private function imageReady():void {
				imageCropper.setCropRect(WIDTH, HEIGHT); 				
			}

			protected function topbargroup1_okClickedHandler(event:MouseEvent):void
			{
				var scaleX:Number = WIDTH/imageCropper.croppedBitmapData.width;
				var scaleY:Number = HEIGHT/imageCropper.croppedBitmapData.height;

				var matrix:Matrix = new Matrix();
				matrix.scale(scaleX, scaleY);
				
				var croppedImage:BitmapData = new BitmapData(WIDTH, HEIGHT, true, 0x000000); 
				croppedImage.draw(imageCropper.croppedBitmapData, matrix, null, null, null, true);

				ok.dispatch(croppedImage);
				this.dispose();
				
			}
			
			public function dispose():void
			{
				if(parent && parent.contains(this)) {
					IVisualElementContainer(parent).removeElement(this);
				}
			}
			
			protected function topbargroup1_backClickedHandler(event:MouseEvent):void
			{
				this.dispose();
				
			}
			
		]]>
	</fx:Script>

	<components:ImageCropper id="imageCropper" left="0" right="0" top="0" bottom="0"
							 constrainToAspectRatio="true" handleColor="#AAAAAA" handleSize="12.0"
							 maskAlpha="0.5" maskColor="#000000" sourceImage="{image}"
							 sourceImageReady="imageReady()"/>
</components:TopBarGroup>
